<!-- views/admin.ejs -->
<%- include('partials/header') %>
<!--
If you do not have partials/header, replace the include above with the commented block below
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <header class="site-header">
    <div style="max-width:1100px;margin:0 auto;">
      <strong>JourneySphere — Admin</strong>
    </div>
  </header>
-->
<link rel="stylesheet" href="/css/admin.css">

<div class="dashboard-container admin-dashboard">
  <!-- Admin header -->
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <p>Manage packages and view all bookings</p>
  </header>

  <!-- Statistics Section -->
  <section class="stats-section" aria-label="Statistics">
    <div class="stat-card" role="article">
      <h3>Total Packages</h3>
      <p class="stat-number"><%= stats.totalPackages %></p>
    </div>

    <div class="stat-card" role="article">
      <h3>Total Bookings</h3>
      <p class="stat-number"><%= stats.totalBookings %></p>
    </div>

    <div class="stat-card" role="article">
      <h3>Total Revenue</h3>
      <p class="stat-number">₹<%= stats.totalRevenue.toLocaleString() %></p>
    </div>
  </section>

  <!-- Package Management Section -->
  <section class="packages-section admin-section" aria-labelledby="packages-heading">
    <div class="section-header">
      <h2 id="packages-heading">Manage Packages (<%= packages.length %>)</h2>
      <a href="/package-form" class="admin-btn primary-btn">+ Add New Package</a>
    </div>

    <% if (packages.length === 0) { %>
      <div class="empty-state" role="status">
        <p>No packages yet. Click "Add New Package" to create one.</p>
      </div>
    <% } else { %>
      <div class="card-list" aria-live="polite">
        <% packages.forEach(pkg => { %>
          <article class="card" aria-label="Package <%= pkg.title %>">
            <div class="card-row">
              <div>
                <h3><%= pkg.title %></h3>
                <p class="muted"><%= pkg.location %> • <span class="meta"><%= pkg.days %> days</span></p>
              </div>

              <div style="text-align:right;">
                <div class="price">₹<%= pkg.price.toLocaleString() %></div>
                <div class="muted" style="font-size:0.88rem;">Created: <%= new Date(pkg.createdAt).toLocaleDateString() %></div>
              </div>
            </div>

            <% if (pkg.description) { %>
              <div class="description">
                <%= pkg.description.length > 220 ? pkg.description.substring(0,220) + '...' : pkg.description %>
              </div>
            <% } %>

            <div class="card-row" style="justify-content:space-between; align-items:center;">
              <div class="muted">ID: <span class="meta"><%= pkg._id %></span></div>
              <div class="card-actions">
                <a href="/package-form/<%= pkg._id %>" class="admin-btn edit-btn" aria-label="Edit <%= pkg.title %>">Edit</a>

                <form method="POST" action="/package-delete/<%= pkg._id %>" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this package?');">
                  <button type="submit" class="admin-btn delete-btn" aria-label="Delete <%= pkg.title %>">Delete</button>
                </form>
              </div>
            </div>
          </article>
        <% }); %>
      </div>
    <% } %>
  </section>

  <!-- Bookings Section -->
  <section class="bookings-section admin-section" aria-labelledby="bookings-heading">
    <div class="section-header">
      <h2 id="bookings-heading">All Bookings (<%= bookings.length %>)</h2>
    </div>

    <% if (bookings.length === 0) { %>
      <div class="empty-state" role="status">
        <p>No bookings yet.</p>
      </div>
    <% } else { %>
      <div class="card-list" aria-live="polite">
        <% bookings.forEach(booking => { %>
          <article class="card" aria-label="Booking for <%= booking.packageTitle %>">
            <div class="card-row">
              <div>
                <strong><%= booking.packageTitle %></strong>
                <div class="muted" style="margin-top:0.25rem;"><%= booking.name %> • <span class="muted"><%= booking.userEmail %></span></div>
              </div>

              <div style="text-align:right;">
                <div class="muted">Travellers: <span class="meta"><%= booking.travellers %></span></div>
                <div class="muted">Start: <%= new Date(booking.startDate).toLocaleDateString() %></div>
              </div>
            </div>

            <div class="card-row" style="justify-content:space-between; align-items:center;">
              <div class="booking-details">
                <p class="muted">Phone: <span class="meta"><%= booking.phone %></span></p>
                <p class="muted">Booked On: <span class="muted"><%= new Date(booking.createdAt).toLocaleDateString() %></span></p>
              </div>

              <div style="text-align:right;">
                <% if (booking.packageId && booking.packageId.price) { %>
                  <div class="revenue">₹<%= (booking.packageId.price * booking.travellers).toLocaleString() %></div>
                <% } else { %>
                  <div class="muted">N/A</div>
                <% } %>
              </div>
            </div>
          </article>
        <% }); %>
      </div>
    <% } %>
  </section>

  <div class="footer-space" aria-hidden="true"></div>
</div>

<%- include('partials/footer') %>
<!--
If you replaced header partial above, close body/html here:
</body>
</html>
-->
